<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Modern Business - Start Bootstrap Template</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/modern-business.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <style type="text/css">
        .form-horizontal .control-label {
            padding-top: 7px;
            margin-bottom: 0;
            text-align: left;
        }
        .progressbar-container {
          margin: auto;
          width: 140px;
          height: auto;
        }
        .progressbar-text{
            top:0!important;
        }
        a {
        text-decoration: none;
        }
    </style>

</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="index.html">Smart Home</a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="about.html">About</a>
                    </li>
                    <li>
                        <a href="services.html">Services</a>
                    </li>
                    <li>
                        <a href="contact.html">Contact</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Portfolio <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="portfolio-1-col.html">1 Column Portfolio</a>
                            </li>
                            <li>
                                <a href="portfolio-2-col.html">2 Column Portfolio</a>
                            </li>
                            <li>
                                <a href="portfolio-3-col.html">3 Column Portfolio</a>
                            </li>
                            <li>
                                <a href="portfolio-4-col.html">4 Column Portfolio</a>
                            </li>
                            <li>
                                <a href="portfolio-item.html">Single Portfolio Item</a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Blog <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="blog-home-1.html">Blog Home 1</a>
                            </li>
                            <li>
                                <a href="blog-home-2.html">Blog Home 2</a>
                            </li>
                            <li>
                                <a href="blog-post.html">Blog Post</a>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Other Pages <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="full-width.html">Full Width Page</a>
                            </li>
                            <li>
                                <a href="sidebar.html">Sidebar Page</a>
                            </li>
                            <li>
                                <a href="faq.html">FAQ</a>
                            </li>
                            <li>
                                <a href="404.html">404</a>
                            </li>
                            <li>
                                <a href="pricing.html">Pricing Table</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Header Carousel -->
    <header id="myCarousel" class="carousel slide  hidden">
        <!-- Indicators -->
        <ol class="carousel-indicators">
            <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
            <li data-target="#myCarousel" data-slide-to="1"></li>
            <li data-target="#myCarousel" data-slide-to="2"></li>
        </ol>

        <!-- Wrapper for slides -->
        <div class="carousel-inner">
            <div class="item active">
                <div class="fill" style="background-image:url('http://placehold.it/1900x1080&text=Slide One');"></div>
                <div class="carousel-caption">
                    <h2>Caption 1</h2>
                </div>
            </div>
            <div class="item">
                <div class="fill" style="background-image:url('http://placehold.it/1900x1080&text=Slide Two');"></div>
                <div class="carousel-caption">
                    <h2>Caption 2</h2>
                </div>
            </div>
            <div class="item">
                <div class="fill" style="background-image:url('http://placehold.it/1900x1080&text=Slide Three');"></div>
                <div class="carousel-caption">
                    <h2>Caption 3</h2>
                </div>
            </div>
        </div>

        <!-- Controls -->
        <a class="left carousel-control" href="#myCarousel" data-slide="prev">
            <span class="icon-prev"></span>
        </a>
        <a class="right carousel-control" href="#myCarousel" data-slide="next">
            <span class="icon-next"></span>
        </a>
    </header>


    <!-- Page Content -->
    <div class="container">


    <!-- Trigger the modal with a button -->
    <button type="button" id="modal-button" class="btn btn-info btn-sm hidden" data-toggle="modal" data-target="#roomModal">Open Modal</button>
    <!-- Modal -->
    <div id="roomModal" class="modal fade" role="dialog">
      <div class="modal-dialog">

        <!-- Modal content-->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            <h4 class="modal-title">Room</h4>
          </div>
          <div class="modal-body">
            <!-- Model Body -->
            <div class="panel-group" id="accordion">
              <form class="form-horizontal" id="accordion-form">
              </form>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div>

      </div>
    </div>

        <!-- Marketing Icons Section -->
        <div class="row" id="rooms-section">
            <div class="col-lg-12">
                <h1 class="page-header">
                    Welcome to Smart Home
                </h1>
            </div>
        </div>
        <!-- /.row -->

        
       
        <!-- Footer -->
        <footer class="hidden">
            <div class="row">
                <div class="col-lg-12">
                    <p>Copyright &copy; Your Website 2014</p>
                </div>
            </div>
        </footer>

    </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Script to Activate the Carousel -->
    <script>
    $('.carousel').carousel({
        interval: 5000 //changes the speed
    });
    </script>

    <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script src="https://rawgit.com/kimmobrunfeldt/progressbar.js/1.0.0/dist/progressbar.js"></script>

    <script type="text/javascript">
       // progressbar.js@1.0.0 version is used
       // Docs: http://progressbarjs.readthedocs.org/en/1.0.0/
       function animateTempBarInit(id){
         var bar = new ProgressBar.SemiCircle(id, {
           strokeWidth: 6,
           color: '#FFEA82',
           trailColor: '#eee',
           trailWidth: 1,
           easing: 'easeInOut',
           duration: 700,
           svgStyle: null,
           text: {
             value: '',
             alignToBottom: false
           },
           from: {color: '#00BFFF'},
           to: {color: '#ED6A5A'},
           // Set default step function for all animate calls
           step: (state, bar) => {
             bar.path.setAttribute('stroke', state.color);
             var value = Math.round(bar.value() * 100);
             if (value === 0) {
               bar.setText('');
             } else {
               bar.setText(value + "Â°F");
             }

             bar.text.style.color = state.color;
           }
         });
         bar.text.style.fontFamily = '"Raleway", Helvetica, sans-serif';
         bar.text.style.fontSize = '2rem';

         //bar.animate(0.5);  // Number from 0.0 to 1.0
         return bar; 
       }
       
    </script>
    <script type="text/javascript">
        var myObject= {
            "room-id": 1,
            "name": "kitchen",
            "sensors":[{
              "id": 1,
              "name": "led",
              "type": "out",
              "mode": "digital",
              "value": 0 //0-off || 1-on
            }, {
              "id": 2,
              "name": "temperatue-sensor",
              "type": "out",
              "mode": "analog",
              "value": 85
            }, {
              "id": 3,
              "name": "t2",
              "type": "in",
              "mode": "digital"
            }, {
              "id": 4,
              "name": "t3",
              "type": "in",
              "mode": "analog"
            }]
        };
        function createPanelEntry(type,id,i) {
          var entry = '<div class="panel panel-default" data-panel-id="panel-'+i+'">\
            <div class="panel-heading sensor-panel-heading" data-toggle="collapse" data-parent="#accordion" data-target="#heading-'+id+'" data-device-type="'+type+'" style="cursor: pointer;">\
              <h4 class="panel-title">\
                <a class="accordion-toggle">\
                '+type+'</a>\
              </h4>\
            </div>\
            <div id="heading-'+id+'" class="panel-collapse collapse ">\
              <div class="panel-body sensor-panel-body">\
              </div>\
            </div>\
          </div>';
          $("#accordion").append(entry);
        }
        function fillRoomModal(arr) {
            var count = Object.keys(arr).length;
            var sensors = arr["sensorsAttached"];
            for(i = 0;i< sensors.length;i++){
              //var to represent roomid+sensor id
              var cid = arr["id"]+'-'+sensors[i]["id"];

              //creating a panel entry in as sliding panel
              //add sensor[i]["name"]
              createPanelEntry(sensors[i]["type"],cid,i);  
            }
        }
    </script>
    <script type="text/javascript">
        //initial JSON string parsing of all room details
        var details = {
            "rooms": [{
                "id": "1",
                "name": "Master Bed room",
                "memory available": "400MB",
                "things in room": ["LED", "TMP SENSOR"]
            }, {
                "id": "2",
                "name": "Kitchen",
                "memory available": "600MB",
                "things in room": ["LED", "TMP SENSOR", "HUMIDITY SENSOR"]
            }, {
                "id": "3",
                "name": "Backyard",
               "memory available": "800MB",
                "things in room": ["LED", "TMP SENSOR", "HUMIDITY SENSOR"]
            }]
        };
        function fillRoomDetails(arr) {
            var out = '<ul>';
            var count = Object.keys(arr).length;
            for (var i = 0; i < arr.length; i++){
                var obj = arr[i];
                for (var key in obj){
                   var value = obj[key];
                   if(key=="sensorsAttached"){
                    out+='<p>Sensors</p><ul>';
                    for(j=0;j<value.length;j++){
                      var o = obj[key][j];
                      for(var k in o){
                        var v = o[k]; 
                        out += '<li>'+ k +' : ' +v +'</li>';
                      }
                      out+='<br>';
                    }
                    out+='</ul>';
                    break;
                   }
                   out += '<li>'+ key +' : ' +value +'</li>';
                 }
                 out+='</ul>';

                 var element = '<div class="col-md-4 room" id="'+obj['id']+'">\
                     <div class="panel panel-default">\
                         <div class="panel-heading room-panel-heading">\
                             <h4><i class="fa fa-home" aria-hidden="true"></i> '+ obj['name']+'</h4>\
                         </div>\
                         <div class="panel-body">\
                         '+out+'\
                         </div>\
                     </div>\
                 </div>';
                 $( "#rooms-section" ).append( element );
                 element = "";
                 out="";
            }
        }
        $( document ).ready(function() {
          $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/devices",
            crossDomain : true,
            success: function(result){
                  fillRoomDetails(result);
              }
            });
        });
        function clearRoomModal(){
          $("#accordion").empty();
        }
        function clearSensorPanel(){
          $(".sensor-panel-body").empty();
        }
        $(document).on('click', '.room-panel-heading', function () {
            var contentPanelId = $( event.target ).closest(".room").attr("id");
            $("#modal-p").text(contentPanelId);
            $( "#modal-button" ).trigger( "click" );
            //clear room modal before filling it
            clearRoomModal();
            $.ajax({
              type: "GET",
              url: 'http://localhost:8080/api/devices/'+contentPanelId,
              crossDomain : true,
              success: function(result){
                    fillRoomModal(result);
                }
              });
        });
        $(document).on('click', '.sensor-panel-heading', function () {
          //on click of a sensor panel header inside model fill the panel body with button related to each method
          if(!$(this).hasClass("collapsed") ){
            clearSensorPanel();
            var element = $(this);
            var device = element.attr("data-device-type");
            $.ajax({
              type: "GET",
              url: 'http://localhost:8080/api/devices/'+device+'/methods',
              crossDomain : true,
              success: function(result){
                    for(i = 0;i< result.length;i++){
                       //create button with func name
                       var button = '<div class="form-group">\
                         <div class="col-sm-offset-1">\
                           <button type="button" class="btn btn-primary">'+result[i]["methodName"]+'</button>\
                         </div>\
                       </div>';
                       element.next().children(".panel-body").append(button);
                     }
                }
              });
          }
        });
    </script>
    
</body>

</html>
